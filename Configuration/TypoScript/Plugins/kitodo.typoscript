# -----------------------------------
# Map GET paramter set[] --> tx_dlf[]
# -----------------------------------

# map set[mets] --> tx_dlf[id]
[like(traverse(request.getQueryParams(), 'set/mets'), 'http*')]
plugin.tx_dlf._DEFAULT_PI_VARS.id.stdWrap.data = GP:set|mets
[END]

# map set[image] --> tx_dlf[page]
[traverse(request.getQueryParams(), 'set/image')]
plugin.tx_dlf._DEFAULT_PI_VARS.page.stdWrap.data = GP:set|image
[END]

# map set[double] --> tx_dlf[double]
[traverse(request.getQueryParams(), 'set/double') > 0]
plugin.tx_dlf._DEFAULT_PI_VARS.double.stdWrap.data = GP:set|double
[END]


# --------------------------------------------------------------------------------------------------------------------
# plugin configuration
# --------------------------------------------------------------------------------------------------------------------

plugin.tx_dlf {
    persistence {
        storagePid = {$config.storagePid}
    }
	view {
		partialRootPaths {
			10 = EXT:slub_digitalcollections/Resources/Private/Plugins/Kitodo/Partials
			20 = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/Partials
		}
		templateRootPaths {
			10 = EXT:slub_digitalcollections/Resources/Private/Plugins/Kitodo/Templates
			20 = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/Templates
		}
	}
}

# --------------------------------------------------------------------------------------------------------------------
# metadata
# --------------------------------------------------------------------------------------------------------------------
plugin.tx_dlf_metadata < tt_content.list.20.dlf_metadata
plugin.tx_dlf_metadata {
    settings {
        excludeOther = 0
        linkTitle = 0
        getTitle = 0
        showFull = 1
        rootline = 1
        separator = #
    }
}

# --------------------------------------------------------------------------------------------------------------------
# pageview / workview
# --------------------------------------------------------------------------------------------------------------------
plugin.tx_dlf_pageview < tt_content.list.20.dlf_pageview
plugin.tx_dlf_pageview {
    settings {
        excludeOther = {$config.kitodo.excludeOther}
        features =
        elementId = tx-dlf-map
    }
}


lib.navigation_pagecontrol = USER
lib.navigation_pagecontrol {
  userFunc = Kitodo\Dlf\Plugin\Navigation->main
  pages = {$config.storagePid}
  pageStep = 10
  templateFile = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/NavigationPageControl.tmpl
}

lib.navigation_viewfunction = USER
lib.navigation_viewfunction {
  userFunc = Kitodo\Dlf\Plugin\Navigation->main
  pages = {$config.storagePid}
  pageStep = 10
  templateFile = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/NavigationViewFunction.tmpl
}

# reduced mobile navigation (page select, fullscreen-button)
lib.navigation_viewfunction_mobile = USER
lib.navigation_viewfunction_mobile {
  userFunc = Kitodo\Dlf\Plugin\Navigation->main
  pages = {$config.storagePid}
  pageStep = 10
  templateFile = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/NavigationViewFunctionMobile.tmpl
}

lib.navigation_viewfunction_deactivated = USER
lib.navigation_viewfunction_deactivated {
  userFunc = Kitodo\Dlf\Plugin\Navigation->main
  pages = {$config.storagePid}
  pageStep = 10
  templateFile = EXT:dfgviewer/Resources/Private/Plugins/Kitodo/NavigationViewFunctionDeactivated.tmpl
}

plugin.tx_dlf_pageview {
  pages = {$config.storagePid}
  excludeOther = 0
  features =
  elementId = tx-dfgviewer-map
  templateFile = {$config.templateFilePage}
  fileGrpImages = MIN,MAX,DEFAULT
}

# --------------------------------------------------------------------------------------------------------------------
# thumbnail previews
# --------------------------------------------------------------------------------------------------------------------
plugin.tx_dlf_pagegrid < tt_content.list.20.dlf_pagegrid
plugin.tx_dlf_pagegrid {
    settings {
        targetPid = #
        placeholder = EXT:dfgviewer/Resources/Public/Images/GridPlaceHolder.jpg
        paginate {
            itemsPerPage = 24
            insertAbove = 0
            insertBelow = 1
            lessPages = 1
            forcedNumberOfLinks = 5
            pagesBefore = 3
            pagesAfter = 3
            section =
        }
    }
}

# --------------------------------------------------------------------------------------------------------------------
# table of contents
# --------------------------------------------------------------------------------------------------------------------
plugin.tx_dlf_tableofcontents < tt_content.list.20.dlf_tableofcontents
plugin.tx_dlf_tableofcontents {
    settings {
        excludeOther = 0
        targetPid = {$config.kitodoPageView}
        menuConf {
            expAll = 1
        }
    }
}


plugin.tx_dlf_tableofcontentss {
  pages = {$config.storagePid}
  excludeOther = 0
  targetPid.data = TSFE:page|uid
  templateFile = {$config.templateFileToc}
  menuConf {
    expAll = 0
    1 = TMENU
    1.noBlur = 1
    1.wrap = <ul class="toc">|</ul>
    1.NO = 1
    1.NO.stdWrap.crop = 55 | &nbsp;... | 1
    1.NO.stdWrap.ifEmpty.field = type
    1.NO.stdWrap.ifEmpty.append = TEXT
    1.NO.stdWrap.ifEmpty.append.fieldRequired = volume
    1.NO.stdWrap.ifEmpty.append.field = volume
    1.NO.stdWrap.ifEmpty.append.wrap = &nbsp;|
    1.NO.stdWrap.dataWrap = | <span class="pagination">{field:pagination}</span>
    1.NO.doNotLinkIt.field = doNotLinkIt
    1.NO.ATagTitle.field = title // type
    1.NO.allWrap = <span class="a">|</span>
    1.NO.allWrap.fieldRequired = doNotLinkIt
    1.NO.wrapItemAndSub = <li>|</li>
    1.IFSUB < .1.NO
    1.IFSUB.wrapItemAndSub = <li class="submenu">|</li>
    1.CUR < .1.NO
    1.CUR.wrapItemAndSub = <li class="current">|</li>
    1.CURIFSUB < .1.NO
    1.CURIFSUB.wrapItemAndSub = <li class="current submenu">|</li>
    1.ACT < .1.NO
    1.ACT.wrapItemAndSub = <li class="active">|</li>
    1.ACTIFSUB < .1.NO
    1.ACTIFSUB.wrapItemAndSub = <li class="active submenu">|</li>
    2 < .1
    2.wrap = <ul>|</ul>
    3 < .2
    4 < .3
    5 < .4
    6 < .5
    7 < .6
    8 < .7
    9 < .8
    10 < .9
  }
}

# --------------------------------------------------------------------------------------------------------------------
# Tools like imagemanipulation, fulltext and downloads eg.
# --------------------------------------------------------------------------------------------------------------------

# available tools:

# fulltexttool
# annotationtool
# fulltextdownloadtool
# imagedownloadtool
# imagemanipulationtool
# pdfdownloadtool
# searchindocumenttool

plugin.tx_dlf_toolbox < tt_content.list.20.dlf_toolbox
plugin.tx_dlf_toolbox {
    settings {
#        fileGrpsImageDownload = MIN,DEFAULT,MAX
    }
}

plugin.tx_dlf_fulltexttool < plugin.tx_dlf_toolbox
plugin.tx_dlf_fulltexttool {
    settings {
        tools = fulltexttool
        activateFullTextInitially = 0
        fullTextScrollElement = html, body
    }
}

plugin.tx_dlf_imagemanipulationtool < plugin.tx_dlf_toolbox
plugin.tx_dlf_imagemanipulationtool {
    settings {
        tools = imagemanipulationtool
    }
}

plugin.tx_dlf_pdfdownloadtool < plugin.tx_dlf_toolbox
plugin.tx_dlf_pdfdownloadtool {
    settings {
        tools = pdfdownloadtool
    }
}

# --------------------------------------------------------------------------------------------------------------------
# Audio player
# --------------------------------------------------------------------------------------------------------------------
plugin.tx_dlf_audioplayer < tt_content.list.20.dlf_audioplayer
plugin.tx_dlf_audioplayer {
    settings {
        excludeOther = 0
        elementId = tx-dlf-audio
    }
}

# --------------------------------------------------------------------------------------------------------------------
# newspaper navigation
# --------------------------------------------------------------------------------------------------------------------

[getDocumentType("{$config.storagePid}") == "ephemera" or getDocumentType("{$config.storagePid}") == "newspaper"]
page.10.variables {
  isNewspaper = TEXT
  isNewspaper.value = newspaper_anchor
}
[END]

[getDocumentType("{$config.storagePid}") == "year"]
page.10.variables {
  isNewspaper = TEXT
  isNewspaper.value = newspaper_year
}
[END]

[getDocumentType("{$config.storagePid}") == "issue"]
page.10.variables {
  isNewspaper = TEXT
  isNewspaper.value = newspaper_issue
}
[END]
